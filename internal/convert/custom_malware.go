package convert

import (
	"github.com/PaloAltoNetworks/terraform-provider-prismacloudcompute/internal/api/feed"
	"github.com/hashicorp/terraform-plugin-sdk/v2/helper/schema"
)

func SchemaToCustomMalwareFeed(d *schema.ResourceData) ([]feed.CustomMalwareFeedItem, error) {
	parsedMalwareFeed := make([]feed.CustomMalwareFeedItem, 0)
	if malwareFeed, ok := d.GetOk("feed"); ok {
		presentFeed := malwareFeed.([]interface{})
		for _, val := range presentFeed {
			presentFeedItem := val.(map[string]interface{})
			parsedFeedItem := feed.CustomMalwareFeedItem{}

			parsedFeedItem.Name = presentFeedItem["name"].(string)
			parsedFeedItem.MD5 = presentFeedItem["md5"].(string)
			parsedFeedItem.Modified = presentFeedItem["modified"].(int)
			parsedFeedItem.Allowed = presentFeedItem["allowed"].(bool)

			parsedMalwareFeed = append(parsedMalwareFeed, parsedFeedItem)
		}
	}
	return parsedMalwareFeed, nil
}

func CustomMalwareFeedToSchema(in []feed.CustomMalwareFeedItem) []interface{} {
	ans := make([]interface{}, 0, len(in))
	for _, val := range in {
		m := make(map[string]interface{})
		m["name"] = val.Name
		m["md5"] = val.MD5
		m["modified"] = val.Modified
		m["allowed"] = val.Allowed
		ans = append(ans, m)
	}
	return ans
}
