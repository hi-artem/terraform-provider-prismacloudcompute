package feed

import (
	"fmt"
	"net/http"

	"github.com/PaloAltoNetworks/terraform-provider-prismacloudcompute/internal/api"
)

const CustomMalwareEndpoint = "api/v1/feeds/custom/malware"

type CustomMalware struct {
	Feed []CustomMalwareFeedItem `json:"feed,omitempty"`
}

type CustomMalwareFeedItem struct {
	MD5      string `json:"md5,omitempty"`
	Name     string `json:"name,omitempty"`
	Modified int    `json:"modified,omitempty"`
	Allowed  bool   `json:"allowed,omitempty"`
}

// Get the current custom malware feed.
func GetCustomMalware(c api.Client) (CustomMalware, error) {
	var ans CustomMalware
	if err := c.Request(http.MethodGet, CustomMalwareEndpoint, nil, nil, &ans); err != nil {
		return ans, fmt.Errorf("error getting custom malware: %s", err)
	}
	return ans, nil
}

// Update the current custom malware feed.
func UpdateCustomMalware(c api.Client, malware CustomMalware) error {
	return c.Request(http.MethodPut, CustomMalwareEndpoint, nil, malware, nil)
}
